<!DOCTYPE html>
<!--
  GTA 21点辅助工具
  
  功能说明：
  - 基于基础策略的21点最优决策系统
  - 支持对子、软牌、硬牌的完整策略分析
  - 提供详细的决策理由和胜率分析
  
  使用方法：
  1. 输入你的手牌（用空格分隔，如：7 5 A）
  2. 输入庄家明牌（如：K）
  3. 点击"获取建议"获得最佳操作
  
  可能的结果和建议：
  - 停牌(Stand)：保持当前点数，不再要牌
  - 要牌(Hit)：再拿一张牌
  - 加倍(Double)：加倍赌注并只拿一张牌
  - 分牌(Split)：将对子分成两手牌
  
  策略优先级：对子策略 > 软牌策略 > 硬牌策略
-->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GTA 21点辅助工具</title>
  <style>
    body {
      background: linear-gradient(135deg, rgb(255, 100, 180) 0%, rgb(200, 150, 255) 50%, rgb(0, 255, 255) 100%);
      color: #1f2937;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      padding: 1rem;
      overflow: hidden;
    }
    .card {
      background-color: #ffffff8f;
      border-radius: 1rem;
      padding: 2rem;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      border: 1px solid #e5e7eb;
    }
    input {
      width: 100%;
      padding: 0.75rem;
      margin-top: 1rem;
      border-radius: 0.75rem;
      border: 1px solid #d1d5db;
      background-color: #ffffff75;
      color: #1f2937;
      font-size: 1rem;
      box-sizing: border-box;
    }
    input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    .btn-row {
      display: flex;
      justify-content: space-between;
      margin-top: 1.5rem;
    }
    button {
      flex: 1;
      margin: 0 0.25rem;
      padding: 0.75rem;
      border: none;
      border-radius: 0.75rem;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .btn-green {
      background-color: #16a34a;
      color: white;
    }
    .btn-green:hover {
      background-color: #22c55e;
    }
    .btn-red {
      background-color: #dc2626;
      color: white;
    }
    .btn-red:hover {
      background-color: #ef4444;
    }
    #output {
      text-align: center;
      margin-top: 1.5rem;
      font-size: 1.25rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- GTA 21点辅助工具主界面 -->
  <!-- 使用说明： -->
  <!-- 1. 输入你的手牌：用空格分隔，如"7 5 A"表示7点、5点、A -->
  <!-- 2. 输入庄家明牌：庄家展示的一张牌，如"K" -->
  <!-- 3. 点击"获取建议"获得最佳策略 -->
  <!-- 4. 建议包括：停牌、要牌、加倍、分牌 -->
  <div class="card">
    <h1 style="text-align:center; font-size: 1.5rem;">GTA 21点辅助工具</h1>
    
    <!-- 玩家手牌输入框 -->
    <input id="playerCards" type="text" placeholder="输入你的牌（例如：7 5 A）" />
    
    <!-- 庄家明牌输入框 -->
    <input id="dealerCard" type="text" placeholder="输入庄家牌（例如：K）" />
    
    <!-- 操作按钮组 -->
    <div class="btn-row">
      <button class="btn-green" onclick="get_advice()">获取建议</button>
      <button class="btn-red" onclick="reset_fields()">重置</button>
    </div>
    
    <!-- 主要建议输出区域 -->
    <div id="output"></div>
    
    <!-- 详细策略说明区域 -->
    <div id="details" style="margin-top: 1rem; font-size: 0.9rem; color: #6b7280;"></div>
  </div>
  <script>
    /**
     * 21点辅助工具 - 基于基础策略的决策系统
     * 
     * 可能的结果和建议说明：
     * 1. 停牌(Stand): 保持当前点数，不再要牌
     *    - 适用于17点及以上硬牌，或19点及以上软牌
     *    - 目标：避免爆牌，让庄家先爆牌
     * 
     * 2. 要牌(Hit): 再拿一张牌
     *    - 适用于点数较低需要改善的情况
     *    - 目标：提高点数以击败庄家
     * 
     * 3. 加倍(Double): 加倍赌注并只拿一张牌
     *    - 适用于优势明显的局面
     *    - 目标：最大化收益
     * 
     * 4. 分牌(Split): 将对子分成两手牌
     *    - 适用于两张相同点数的牌
     *    - 目标：将劣势局面转为优势局面
     */

    /**
     * 解析单张牌的值
     * @param {string} card - 片面值 (如: "K", "7", "A")
     * @returns {number} 牌的数值，无效返回NaN
     */
    function parse_card(card) {
      const face_card_values = { K: 10, Q: 10, J: 10, A: 11 };
      const card_val = card.trim().toUpperCase();
      
      // 检查是否为有效的牌面值
      if (face_card_values.hasOwnProperty(card_val)) {
        return face_card_values[card_val];
      }
      
      // 检查是否为2-10的数字
      const num_val = parseInt(card_val);
      if (num_val >= 2 && num_val <= 10) {
        return num_val;
      }
      
      // 无效牌值返回NaN
      return NaN;
    }

    /**
     * 计算手牌总点数和是否为软牌
     * @param {number[]} cards - 牌值数组
     * @returns {object} {total: 总点数, isSoft: 是否为软牌}
     * 
     * 软牌说明：
     * - 软牌：手中有A且A算作11点，总点数不会爆牌
     * - 硬牌：没有A，或所有A都算作1点
     * - 软牌优势：可以安全要牌而不爆牌
     */
    function calculate_hand_value(cards) {
      let total_points = cards.reduce((acc, val) => acc + val, 0);
      let total_aces = cards.filter(val => val === 11).length;
      let aces_as_eleven = total_aces;
      
      // 处理软牌的情况：如果总点数超过21且有A，将A从11点调整为1点
      while (total_points > 21 && aces_as_eleven > 0) {
        total_points -= 10;
        aces_as_eleven--;
      }
      
      // 只要有A在牌中，且至少有一张A算作11点，就是软牌
      return { total: total_points, isSoft: total_aces > 0 && aces_as_eleven > 0 };
    }

    /**
     * 检查是否为对子
     * @param {number[]} cards - 牌值数组
     * @returns {boolean} 是否为对子
     */
    function is_pair(cards) {
      return cards.length === 2 && cards[0] === cards[1];
    }

    /**
     * 获取21点最佳建议
     * 决策优先级：对子策略 > 软牌策略 > 硬牌策略
     * 
     * 策略说明：
     * 1. 对子策略：两张相同牌时的特殊处理
     * 2. 软牌策略：包含A的灵活手牌
     * 3. 硬牌策略：普通点数手牌
     */
    function get_advice() {
      const player_input = document.getElementById("playerCards").value;
      const dealer_input = document.getElementById("dealerCard").value;
      const output_element = document.getElementById("output");
      const details_element = document.getElementById("details");

      const player_cards = player_input.split(/[\s,]+/).map(parse_card).filter(n => !isNaN(n));
      const dealer_card = parse_card(dealer_input);

      if (player_cards.length < 2 || isNaN(dealer_card)) {
        output_element.textContent = "请输入至少两张有效的玩家牌和一张有效的庄家牌。";
        output_element.style.color = "#f87171";
        details_element.textContent = "";
        return;
      }

      const { total, isSoft } = calculate_hand_value(player_cards);
      if (total > 21) {
        output_element.textContent = "爆牌";
        output_element.style.color = "#f87171";
        details_element.textContent = "";
        return;
      }

      let advice_text = "";
      let detail_text = "";
      const [card1, card2] = player_cards;

      // 显示手牌信息
      const hand_type = isSoft ? "软牌" : "硬牌";
      const pair_info = is_pair(player_cards) ? "对子" : "";
      detail_text = `手牌：${total}点 (${hand_type}${pair_info ? ", " + pair_info : ""}) | 庄家：${dealer_card}点`;

      // 对子决策优先级最高
      if (is_pair(player_cards)) {
        const pair_advice = get_pair_advice(card1, dealer_card);
        if (pair_advice === "分牌") {
          advice_text = "分牌";
          // 分牌后如果某一侧又形成对子的建议
          const after_split_pair_advice = get_after_split_pair_advice(card1, dealer_card);
          detail_text += ` | 对子策略：${get_pair_reason(card1, dealer_card)} | 分牌后若一侧仍为对子：${after_split_pair_advice}`;
        } else {
          // 对子策略不是分牌时，继续使用硬牌策略
          advice_text = get_hard_advice(total, dealer_card);
          detail_text += ` | 对子策略：${get_pair_reason(card1, dealer_card)} | 硬牌策略：${get_hard_reason(total, dealer_card)}`;
        }
      }
      
      // 如果没有对子建议，则根据软牌或硬牌给出建议
      if (!advice_text) {
        if (isSoft) {
          advice_text = get_soft_advice(total, dealer_card, player_cards.length);
          // 如果牌数超过2张且建议是加倍，则改为要牌
          if (player_cards.length > 2 && advice_text === "加倍") {
            advice_text = "要牌";
            detail_text += ` | 软牌策略：${get_soft_reason(total, dealer_card, player_cards.length)} `;
          } else {
            detail_text += ` | 软牌策略：${get_soft_reason(total, dealer_card, player_cards.length)}`;
          }
        } else {
          advice_text = get_hard_advice(total, dealer_card);
          // 如果牌数超过2张且建议是加倍，则改为要牌
          if (player_cards.length > 2 && advice_text === "加倍") {
            advice_text = "要牌";
            detail_text += ` | 硬牌策略：${get_hard_reason(total, dealer_card, player_cards.length)} `;
          } else {
            detail_text += ` | 硬牌策略：${get_hard_reason(total, dealer_card, player_cards.length)}`;
          }
        }
      }

      output_element.textContent = `最佳操作：${advice_text}`;
      output_element.style.color = "#dc2626";
      
      // 计算概率
      const bust_prob = calculate_bust_probability(total, isSoft);
      const win_prob = calculate_win_probability(total, isSoft, dealer_card, advice_text);
      
      // 添加概率信息到详情中
      const probability_text = ` | 爆牌概率：${(bust_prob * 100).toFixed(1)}% | 获胜概率：${(win_prob * 100).toFixed(1)}%`;
      details_element.textContent = detail_text + probability_text;
    }

    /**
     * 对子策略决策
     * 对子分牌的优势：将一手牌变成两手，增加获胜机会
     * 
     * @param {number} pairValue - 对子的值
     * @param {number} dealer - 庄家明牌值
     * @returns {string} 建议：分牌/不分牌/加倍/要牌
     */
    function get_pair_advice(pair_value, dealer_card) {
      // 对A：总是分牌
      // 理由：两张A分牌后，每张都有机会拿到10点形成21点
      if (pair_value === 11) return "分牌";
      
      // 对8：总是分牌
      // 理由：16点是最差的硬牌，分牌后有机会形成更好的手牌
      if (pair_value === 8) return "分牌";
      
      // 对10、J、Q、K：从不分牌
      // 理由：20点已经是极好的手牌，分牌反而可能降低胜率
      if (pair_value === 10) return "不分牌";
      
      // 对9：庄家2-6点、8-9点分牌，庄家7点、10点、A不分牌
      // 理由：18点不错，但在庄家弱势时分牌更有利
      if (pair_value === 9) {
        if ([2, 3, 4, 5, 6, 8, 9].includes(dealer_card)) return "分牌";
        return "不分牌";
      }
      
      // 对7：庄家2-7点分牌，庄家8-A不分牌
      // 理由：14点不算好，在庄家弱势时分牌有机会
      if (pair_value === 7) {
        if ([2, 3, 4, 5, 6, 7].includes(dealer_card)) return "分牌";
        return "不分牌";
      }
      
      // 对6：庄家2-6点分牌，庄家7-A不分牌
      // 理由：12点很差，在庄家弱势时分牌是唯一机会
      if (pair_value === 6) {
        if ([2, 3, 4, 5, 6].includes(dealer_card)) return "分牌";
        return "不分牌";
      }
      
      // 对5：庄家2-9点加倍，庄家10点、A要牌
      // 理由：10点很好，在庄家弱势时加倍有利
      if (pair_value === 5) {
        if ([2, 3, 4, 5, 6, 7, 8, 9].includes(dealer_card)) return "加倍";
        return "要牌";
      }
      
      // 对4、对2、对3：庄家2-7点分牌，庄家8-A不分牌
      // 理由：点数很低，只有在庄家弱势时才冒险分牌
      if ([2, 3, 4].includes(pair_value)) {
        if ([2, 3, 4, 5, 6, 7].includes(dealer_card)) return "分牌";
        return "不分牌";
      }
      
      return "";
    }

    /**
     * 硬牌策略决策
     * 硬牌特点：没有A或A算作1点，要牌有爆牌风险
     * 
     * @param {number} total - 手牌总点数
     * @param {number} dealer - 庄家明牌值
     * @returns {string} 建议：停牌/要牌/加倍
     */
    function get_hard_advice(total_points, dealer_card) {
      // 硬牌17点及以上：总是停牌
      // 理由：点数已经很高，爆牌风险大于收益
      if (total_points >= 17) return "停牌";
      
      // 硬牌13-16点：庄家2-6点停牌，庄家7-A要牌
      // 理由：中等点数，庄家弱势时保守，强势时冒险
      if (total_points >= 13 && total_points <= 16) {
        if ([2, 3, 4, 5, 6].includes(dealer_card)) return "停牌";
        return "要牌";
      }
      
      // 硬牌12点：庄家2-3点要牌，庄家4-6点停牌，庄家7-A要牌
      // 理由：12点很危险，只有在庄家最容易爆牌时才停牌
      if (total_points === 12) {
        if ([4, 5, 6].includes(dealer_card)) return "停牌";
        return "要牌";
      }
      
      // 硬牌11点：总是加倍
      // 理由：11点极佳，有30%机会拿到21点，加倍收益最大
      if (total_points === 11) return "加倍";
      
      // 硬牌10点：庄家2-9点加倍，庄家10点、A要牌
      // 理由：10点很好，在庄家弱势时加倍有利
      if (total_points === 10) {
        if ([2, 3, 4, 5, 6, 7, 8, 9].includes(dealer_card)) return "加倍";
        return "要牌";
      }
      
      // 硬牌9点及以下：总是要牌
      // 理由：点数太低，必须要牌改善
      return "要牌";
    }

    /**
     * 软牌策略决策
     * 软牌特点：包含A且A算作11点，要牌不会爆牌（最多变为硬牌）
     * 
     * @param {number} total - 手牌总点数
     * @param {number} dealer - 庄家明牌值
     * @param {number} cardCount - 手牌数量
     * @returns {string} 建议：停牌/要牌/加倍
     */
    function get_soft_advice(total_points, dealer_card, card_count) {
      // 软牌19-20点：总是停牌
      // 理由：点数已经很高，改善空间有限，停牌保守
      if (total_points >= 19) return "停牌";
      
      // 软牌18点：庄家2-6点停牌，庄家7-8点要牌，庄家9-10点、A停牌
      // 理由：18点不错，但根据庄家强弱决定是否冒险
      if (total_points === 18) {
        if ([2, 3, 4, 5, 6].includes(dealer_card)) return "停牌";
        if ([7, 8].includes(dealer_card)) return "要牌";
        return "停牌";
      }
      
      // 软牌17点：只有2张牌时(A+6)才考虑加倍，否则要牌
      // 理由：软17很灵活，初始手牌时可以加倍，多张牌时保守
      if (total_points === 17) {
        if (card_count === 2 && [2, 3, 4, 5, 6].includes(dealer_card)) return "加倍";
        return "要牌";
      }
      
      // 软牌16点：只有2张牌时(A+5)才考虑加倍，否则要牌
      // 理由：软16同样灵活，在庄家弱势时可以加倍
      if (total_points === 16) {
        if (card_count === 2 && [2, 3, 4, 5, 6].includes(dealer_card)) return "加倍";
        return "要牌";
      }
      
      // 软牌13-15点：总是要牌
      // 理由：点数较低，软牌优势明显，必须要牌改善
      return "要牌";
    }

    function get_pair_reason(pair_value, dealer_card) {
      if (pair_value === 11) return "A对总是分牌，两张黑杰克的机会";
      if (pair_value === 8) return "8对总是分牌，16点是最差硬牌";
      if (pair_value === 10) return "10点对从不分牌，20点已很强";
      if (pair_value === 9) {
        if ([2, 3, 4, 5, 6, 8, 9].includes(dealer_card)) return "庄家弱势或中等，分牌有利";
        return "庄家强势，不分牌更安全";
      }
      if (pair_value === 7) {
        if ([2, 3, 4, 5, 6, 7].includes(dealer_card)) return "庄家弱势，分牌有机会";
        return "庄家强势，不分牌更安全";
      }
      if (pair_value === 6) {
        if ([2, 3, 4, 5, 6].includes(dealer_card)) return "庄家弱势，分牌有机会";
        return "庄家强势，不分牌更安全";
      }
      if (pair_value === 5) {
        if ([2, 3, 4, 5, 6, 7, 8, 9].includes(dealer_card)) return "庄家弱势，加倍有利";
        return "庄家强势，要牌更安全";
      }
      if ([2, 3, 4].includes(pair_value)) {
        if ([2, 3, 4, 5, 6, 7].includes(dealer_card)) return "庄家弱势，分牌有机会";
        return "庄家强势，不分牌更安全";
      }
      return "";
    }

    function get_after_split_pair_advice(pair_value, dealer_card) {
      // 分牌后如果某一侧又形成对子，通常不能再分牌，给出要牌/停牌建议
      
      // 分牌后对A：要牌（软牌12点，很好的起点）
      if (pair_value === 11) return "要牌";

      // 分牌后对10、J、Q、K：停牌（20点很强）
      if (pair_value === 10) return "停牌";
      
      // 分牌后对9：停牌（18点很强，避免爆牌风险）
      if (pair_value === 9) return "停牌";
      
      // 分牌后对8：要牌（16点硬牌，需要改善）
      if (pair_value === 8) return "要牌";

      // 分牌后对7：要牌（14点需要改善）
      if (pair_value === 7) return "要牌";
      
      // 分牌后对6：要牌（12点需要改善）
      if (pair_value === 6) return "要牌";

      // 必须要牌
      if ([2, 3, 4].includes(pair_value)) return "要牌";
    }

    function get_hard_reason(total_points, dealer_card, card_count = 2) {
      if (total_points >= 17) return "17点及以上总是停牌";
      if (total_points >= 13 && total_points <= 16) {
        if ([2, 3, 4, 5, 6].includes(dealer_card)) return "庄家弱势，保守停牌";
        return "庄家强势，必须要牌";
      }
      if (total_points === 12) {
        if ([4, 5, 6].includes(dealer_card)) return "庄家最容易爆牌，停牌有利";
        return "需要改善手牌，要牌";
      }
      if (total_points === 11) {
        return card_count > 2 ? "11点，要牌改善" : "11点总是加倍，很强";
      }
      if (total_points === 10) {
        if ([2, 3, 4, 5, 6, 7, 8, 9].includes(dealer_card)) {
          return card_count > 2 ? "10点，庄家弱势，要牌改善" : "庄家弱势，加倍有利";
        }
        return "庄家强势，要牌更安全";
      }
      return "9点及以下总是要牌";
    }

    function get_soft_reason(total_points, dealer_card, card_count = 2) {
      if (total_points >= 19) return "19点及以上总是停牌";
      if (total_points === 18) {
        if ([2, 3, 4, 5, 6].includes(dealer_card)) return "庄家弱势，停牌有利";
        if ([7, 8].includes(dealer_card)) return "需要改善手牌，要牌";
        return "庄家很强，停牌保守";
      }
      if (total_points === 17) {
        if ([2, 3, 4, 5, 6].includes(dealer_card)) {
          if (card_count === 2) return "软牌17点(A+6)，庄家弱势，加倍有利";
          return "软牌17点多张牌，庄家弱势，要牌改善";
        }
        return "软牌，庄家强势，不爆牌，要牌";
      }
      if (total_points === 16) {
        if ([2, 3, 4, 5, 6].includes(dealer_card)) {
          if (card_count === 2) return "软牌16点(A+5)，庄家弱势，加倍有利";
          return "软牌16点多张牌，庄家弱势，要牌改善";
        }
        return "软牌，庄家强势，不爆牌，要牌";
      }
      return "软牌爆牌风险低，要牌";
    }

    /**
     * 计算玩家爆牌概率（基于无限牌组的随机概率）
     * 
     * 无限牌组假设：
     * - 每张牌出现的概率均等，不受已出现牌的影响
     * - 牌面值分布：2,3,4,5,6,7,8,9,10,J,Q,K,A (13种)
     * - 对应点数：2,3,4,5,6,7,8,9,10,10,10,10,11
     * - 注意：10,J,Q,K都是10点，所以10点出现概率更高(4/13)
     * 
     * @param {number} current_total - 当前手牌总点数
     * @param {boolean} is_soft - 是否为软牌
     * @returns {number} 爆牌概率 (0-1之间)
     */
    function calculate_bust_probability(current_total, is_soft) {
      // 已经爆牌的情况，概率为100%
      if (current_total > 21) return 1;
      
      // 无限牌组的牌面值和对应概率
      // 牌面：2,3,4,5,6,7,8,9,10,J,Q,K,A
      // 点数：2,3,4,5,6,7,8,9,10,10,10,10,11
      // 概率：每种1/13，但10点有4种牌，所以概率不同
      const card_distribution = [
        { value: 2, probability: 1/13 },
        { value: 3, probability: 1/13 },
        { value: 4, probability: 1/13 },
        { value: 5, probability: 1/13 },
        { value: 6, probability: 1/13 },
        { value: 7, probability: 1/13 },
        { value: 8, probability: 1/13 },
        { value: 9, probability: 1/13 },
        { value: 10, probability: 4/13 }, // 10,J,Q,K都是10点
        { value: 11, probability: 1/13 }  // A
      ];
      
      let bust_probability = 0;
      
      // 遍历所有可能的下一张牌
      for (let card of card_distribution) {
        let new_total = current_total + card.value;
        
        // 处理软牌的特殊情况
        if (is_soft) {
          // 软牌爆牌时，可以将一个A从11点改为1点（减少10点）
          if (new_total > 21) {
            new_total -= 10;
          }
        }
        
        // 如果调整后的点数仍然爆牌，累加该牌的爆牌概率
        if (new_total > 21) {
          bust_probability += card.probability;
        }
      }
      
      return bust_probability;
    }

    /**
     * 计算庄家最终点数分布概率（使用平均值计算）
     * @param {number} dealerCard - 庄家明牌值
     * @returns {object} 各种最终点数的概率分布
     */
    function calculate_dealer_probabilities(dealer_card) {
      // 使用平均值简化的庄家概率计算
      const avg_card_value = 7.31;
      const dealer_target = 17;
      
      // 基于庄家明牌的简化概率估算
      let bust_prob, final_17, final_18, final_19, final_20, final_21;
      
      if (dealer_card <= 6) {
        // 庄家弱势明牌(2-6)
        bust_prob = 0.40;
        final_17 = 0.15;
        final_18 = 0.13;
        final_19 = 0.12;
        final_20 = 0.11;
        final_21 = 0.09;
      } else if (dealer_card === 7) {
        // 庄家中等明牌(7)
        bust_prob = 0.26;
        final_17 = 0.37;
        final_18 = 0.14;
        final_19 = 0.08;
        final_20 = 0.08;
        final_21 = 0.07;
      } else if (dealer_card <= 9) {
        // 庄家较强明牌(8-9)
        bust_prob = 0.23;
        final_17 = 0.12;
        final_18 = 0.35;
        final_19 = 0.23;
        final_20 = 0.04;
        final_21 = 0.03;
      } else {
        // 庄家强势明牌(10-A)
        bust_prob = 0.16;
        final_17 = 0.12;
        final_18 = 0.11;
        final_19 = 0.11;
        final_20 = 0.26;
        final_21 = 0.24;
      }
      
      return { bust: bust_prob, 17: final_17, 18: final_18, 19: final_19, 20: final_20, 21: final_21 };
    }

    /**
     * 计算平均牌值（用于概率估算）
     * @returns {number} 平均牌值
     */
    function get_average_card_value() {
      // 平均值计算：
      // 13种牌面值：2,3,4,5,6,7,8,9,10,J,Q,K,A
      // 对应点数：2,3,4,5,6,7,8,9,10,10,10,10,11
      // 总和：2+3+4+5+6+7+8+9+10+10+10+10+11 = 95
      // 平均值：95 ÷ 13 ≈ 7.31
      return 7.31; // 预计算平均值
    }

    /**
     * 计算玩家获胜概率（使用平均值计算）
     * @param {number} playerTotal - 玩家当前点数
     * @param {boolean} isSoft - 是否为软牌
     * @param {number} dealerCard - 庄家明牌值
     * @param {string} action - 建议的动作 (停牌/要牌/加倍)
     * @returns {number} 获胜概率 (0-1之间)
     */
    function calculate_win_probability(player_total, is_soft, dealer_card, action) {
      const dealer_probs = calculate_dealer_probabilities(dealer_card);
      const avg_card_value = 7.31;
      
      if (action === "停牌") {
        // 停牌情况：基于平均值的直接比较
        let win_prob = dealer_probs.bust; // 庄家爆牌则玩家赢
        
        // 玩家没爆牌，比较点数
        if (player_total <= 21) {
          for (let dealer = 17; dealer <= 21; dealer++) {
            if (player_total > dealer) {
              win_prob += dealer_probs[dealer];
            }
          }
        }
        
        return win_prob;
      } else if (action === "要牌" || action === "加倍") {
        // 使用平均值的简化计算
        const bust_prob = calculate_bust_probability(player_total, is_soft);
        const hit_success_prob = 1 - bust_prob;
        
        // 基于平均牌值估算新点数
        const avg_new_total = player_total + avg_card_value;
        
        let win_prob = dealer_probs.bust * hit_success_prob;
        
        if (avg_new_total <= 21) {
          for (let dealer = 17; dealer <= 21; dealer++) {
            if (avg_new_total > dealer) {
              win_prob += dealer_probs[dealer] * hit_success_prob;
            }
          }
        }
        
        // 根据动作类型调整胜率上限
        if (action === "加倍") {
          return Math.min(win_prob, 0.60); // 加倍最高60%胜率
        } else {
          return Math.min(win_prob, 0.50); // 要牌最高50%胜率
        }
      }
      
      return 0.5; // 默认50%
    }

    /**
     * 重置所有输入和输出字段
     * 清空界面，准备下一次分析
     */
    function reset_fields() {
      document.getElementById("playerCards").value = "";
      document.getElementById("dealerCard").value = "";
      document.getElementById("output").textContent = "";
      document.getElementById("details").textContent = "";
    }
  </script>
</body>
</html>